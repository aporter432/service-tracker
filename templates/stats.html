{% extends "base.html" %}

{% block title %}Statistics - ORBCOMM Tracker{% endblock %}

{% block content %}
<div class="stats-page">
    <div class="page-header">
        <h2>Statistics</h2>
    </div>

    <!-- Current Stats -->
    <div class="stats-grid">
        <div class="stat-card">
            <h3>Total Notifications</h3>
            <div class="stat-value">{{ current_stats.total_notifications }}</div>
        </div>
        <div class="stat-card open">
            <h3>Open Issues</h3>
            <div class="stat-value">{{ current_stats.open_count }}</div>
        </div>
        <div class="stat-card resolved">
            <h3>Resolved</h3>
            <div class="stat-value">{{ current_stats.resolved_count }}</div>
        </div>
        <div class="stat-card">
            <h3>Avg Resolution Time</h3>
            <div class="stat-value">{{ current_stats.avg_resolution_time_minutes|format_duration }}</div>
        </div>
    </div>

    <!-- Platform Breakdown -->
    <div class="section">
        <h3>Platform Distribution</h3>
        <div class="breakdown-grid">
            {% for platform, count in platform_stats.items() %}
            <div class="breakdown-card">
                <span class="badge badge-{{ platform|lower }}">{{ platform }}</span>
                <div class="breakdown-value">{{ count }}</div>
                <div class="breakdown-percent">{{ ((count / current_stats.total_notifications) * 100)|round(1) }}%</div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Event Type Breakdown -->
    <div class="section">
        <h3>Event Type Distribution</h3>
        <table class="table">
            <thead>
                <tr>
                    <th>Event Type</th>
                    <th>Count</th>
                    <th>Percentage</th>
                </tr>
            </thead>
            <tbody>
                {% for event_type, count in event_stats.items()|sort(attribute='1', reverse=True) %}
                <tr>
                    <td>{{ event_type }}</td>
                    <td>{{ count }}</td>
                    <td>{{ ((count / current_stats.total_notifications) * 100)|round(1) }}%</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Historical Trends -->
    {% if historical %}
    <div class="section">
        <h3>Historical Trends (Last 30 Days)</h3>
        <table class="table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Total</th>
                    <th>Open</th>
                    <th>Resolved</th>
                    <th>Avg Resolution</th>
                </tr>
            </thead>
            <tbody>
                {% for snapshot in historical|reverse %}
                <tr>
                    <td>{{ snapshot.snapshot_date|format_date }}</td>
                    <td>{{ snapshot.total_notifications }}</td>
                    <td>{{ snapshot.open_count }}</td>
                    <td>{{ snapshot.resolved_count }}</td>
                    <td>{{ snapshot.avg_resolution_time_minutes|format_duration }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}
</div>
{% endblock %}
